/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.8.3/userguide/building_java_projects.html
 */

plugins {
    id 'jacoco'
    id 'org.springframework.boot' version '2.4.4'
    id 'io.spring.dependency-management' version '1.0.11.RELEASE'
    id 'java'
    id 'groovy' // Apply the groovy plugin to also add support for Groovy (needed for Spock)
    id 'application' // Apply the application plugin to add support for building a CLI application in Java.
    id "org.sonarqube" version "3.1.1"
    id 'com.palantir.docker' version '0.20.1'
}

group = 'rabbithole'
version = '1.0.0-SNAPSHOT'

repositories {
    // Use JCenter for resolving dependencies.
    jcenter()
}

docker {
    dependsOn build
    name "${project.group}/${rootProject.name}:${project.version}"
    files bootJar.archivePath
    buildArgs(['JAR_FILE': "${bootJar.archiveName}"])
}

jacoco {
    toolVersion = "0.8.2"
}

jacocoTestReport {
    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it,
                    exclude: ['**/configuration/**',
                              '**/Application*',
                              '**/dto/**'
                    ]
            )
        }))
    }
}

dependencies {
    implementation 'com.google.guava:guava:29.0-jre'
    implementation group: 'org.springdoc', name: 'springdoc-openapi-webflux-ui', version: '1.5.7'
    implementation group: 'org.springframework.integration', name: 'spring-integration-webflux'

    implementation group: 'io.projectreactor.addons', name: 'reactor-extra'
    implementation group: 'org.apache.commons', name: 'commons-lang3'

    implementation("org.springframework.boot:spring-boot-starter-webflux")
    implementation group: 'org.springframework.boot', name: 'spring-boot-starter-actuator'
    implementation group: 'org.springframework.boot', name: 'spring-boot-starter-data-mongodb-reactive'
    //    validation
    implementation group: 'org.hibernate', name: 'hibernate-validator', version: '6.0.16.Final'
    implementation('org.springframework.boot:spring-boot-starter-validation')

    implementation group: 'com.fasterxml.jackson.datatype', name: 'jackson-datatype-jdk8'
    implementation group: 'com.fasterxml.jackson.datatype', name: 'jackson-datatype-jsr310'

//    implementation group: 'org.sonarsource.scanner.maven', name: 'sonar-maven-plugin', version: '3.8.0.2131'

    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation group: 'org.spockframework', name: 'spock-core', version: '1.3-groovy-2.5'
    testImplementation group: 'org.spockframework', name: 'spock-spring', version: '1.3-groovy-2.5'
    testImplementation group: 'io.projectreactor', name: 'reactor-test', version: '3.4.5'
    testImplementation("org.springframework.cloud:spring-cloud-stream-test-support:3.1.2")
    testImplementation group: 'de.flapdoodle.embed', name: 'de.flapdoodle.embed.mongo', version: '2.2.0'

    // Use the latest Groovy version for Spock testing
    testImplementation 'org.codehaus.groovy:groovy-all:2.5.13'

    testImplementation 'junit:junit:4.13'
}

